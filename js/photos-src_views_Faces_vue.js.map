{"version":3,"file":"photos-src_views_Faces_vue.js?v=bbc2238d86887a7a22fc","mappings":"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","sources":["webpack:///photos/src/mixins/AbortControllerMixin.js","webpack:///photos/src/mixins/FaceCoverMixin.js","webpack:///photos/src/mixins/FetchFacesMixin.js","webpack:///photos/src/components/FaceCover.vue?vue&type=style&index=0&id=1f2ce110&lang=scss&scoped=true&","webpack:///photos/src/views/Faces.vue?vue&type=style&index=0&id=41711a97&lang=scss&scoped=true&","webpack:///photos/node_modules/vue-material-design-icons/AccountBoxMultipleOutline.vue","webpack:///photos/node_modules/vue-material-design-icons/AccountBoxMultipleOutline.vue?vue&type=script&lang=js&","webpack://photos/./node_modules/vue-material-design-icons/AccountBoxMultipleOutline.vue?a4da","webpack:///photos/node_modules/vue-material-design-icons/AccountBoxMultipleOutline.vue?vue&type=template&id=6bcc1fce&","webpack:///photos/src/views/Faces.vue?vue&type=template&id=41711a97&scoped=true&","webpack:///photos/src/components/FaceCover.vue","webpack:///photos/src/components/FaceCover.vue?vue&type=script&lang=js&","webpack://photos/./src/components/FaceCover.vue?b0a3","webpack:///photos/src/views/Faces.vue","webpack:///photos/src/views/Faces.vue?vue&type=script&lang=js&","webpack://photos/./src/components/FaceCover.vue?d6a7","webpack:///photos/src/components/FaceCover.vue?vue&type=template&id=1f2ce110&scoped=true&","webpack://photos/./src/views/Faces.vue?5888","webpack://photos/./src/views/Faces.vue?a265"],"sourcesContent":["/**\r\n * @copyright Copyright (c) 2022 Louis Chemineau <louis@chmn.me>\r\n *\r\n * @author Louis Chemineau <louis@chmn.me>\r\n *\r\n * @license AGPL-3.0-or-later\r\n *\r\n * This program is free software: you can redistribute it and/or modify\r\n * it under the terms of the GNU Affero General Public License as\r\n * published by the Free Software Foundation, either version 3 of the\r\n * License, or (at your option) any later version.\r\n *\r\n * This program is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\n * GNU Affero General Public License for more details.\r\n *\r\n * You should have received a copy of the GNU Affero General Public License\r\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\r\n *\r\n */\r\n\r\nexport default {\r\n\tname: 'AbortControllerMixin',\r\n\r\n\tdata() {\r\n\t\treturn {\r\n\t\t\tabortController: new AbortController(),\r\n\t\t}\r\n\t},\r\n\r\n\tbeforeDestroy() {\r\n\t\tthis.abortController.abort()\r\n\t},\r\n\r\n\tbeforeRouteLeave(from, to, next) {\r\n\t\tthis.abortController.abort()\r\n\t\tthis.abortController = new AbortController()\r\n\t\tnext()\r\n\t},\r\n}\r\n","/**\r\n * @copyright Copyright (c) 2022 Marcel Klehr <mklehr@gmx.net>\r\n *\r\n * @author Marcel Klehr <mklehr@gmx.net>\r\n *\r\n * @license AGPL-3.0-or-later\r\n *\r\n * This program is free software: you can redistribute it and/or modify\r\n * it under the terms of the GNU Affero General Public License as\r\n * published by the Free Software Foundation, either version 3 of the\r\n * License, or (at your option) any later version.\r\n *\r\n * This program is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\n * GNU Affero General Public License for more details.\r\n *\r\n * You should have received a copy of the GNU Affero General Public License\r\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\r\n *\r\n */\r\n\r\nimport { mapGetters } from 'vuex'\r\nimport he from 'he'\r\n\r\nexport default {\r\n\tname: 'FaceCoverMixin',\r\n\r\n\tcomputed: {\r\n\t\t...mapGetters([\r\n\t\t\t'faces',\r\n\t\t\t'facesFiles',\r\n\t\t\t'files',\r\n\t\t]),\r\n\t},\r\n\r\n\tmethods: {\r\n\t\tgetFaceCover(faceName) {\r\n\t\t\t// Give high scores for faces that intersect with the edge of the picture (with a margin of half the face size)\r\n\t\t\tconst scoreFacePosition = (faceDetection) => {\r\n\t\t\t\treturn Math.max(0, -1 * (faceDetection.x - faceDetection.width * 0.5))\r\n\t\t\t\t+ Math.max(0, -1 * (faceDetection.y - faceDetection.height * 0.5))\r\n\t\t\t\t+ Math.max(0, -1 * (1 - (faceDetection.x + faceDetection.width) - faceDetection.width * 0.5))\r\n\t\t\t\t+ Math.max(0, -1 * (1 - (faceDetection.y + faceDetection.height) - faceDetection.height * 0.5))\r\n\t\t\t}\r\n\r\n\t\t\treturn (this.facesFiles[faceName] || [])\r\n\t\t\t\t.slice(0, 25)\r\n\t\t\t\t.map(fileId => this.files[fileId])\r\n\t\t\t\t.map(file => ({ ...file, faceDetections: JSON.parse(he.decode(file.faceDetections)) }))\r\n\t\t\t\t// sort larges face first\r\n\t\t\t\t.sort((a, b) =>\r\n\t\t\t\t\tb.faceDetections.find(d => d.title === faceName).width\r\n\t\t\t\t\t- a.faceDetections.find(d => d.title === faceName).width\r\n\t\t\t\t)\r\n\t\t\t\t// sort fewest face detections first\r\n\t\t\t\t.sort((a, b) =>\r\n\t\t\t\t\ta.faceDetections.length\r\n\t\t\t\t\t- b.faceDetections.length\r\n\t\t\t\t)\r\n\t\t\t\t// Sort faces that are at the edge last\r\n\t\t\t\t.sort((a, b) =>\r\n\t\t\t\t\tscoreFacePosition(a.faceDetections.find(d => d.title === faceName))\r\n\t\t\t\t\t- scoreFacePosition(b.faceDetections.find(d => d.title === faceName))\r\n\t\t\t\t)[0]\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * This will produce an inline style to apply to images\r\n\t\t * to zoom toward the detected face\r\n\t\t *\r\n\t\t * @param faceName\r\n\t\t * @return {{}|{transform: string, width: string, transformOrigin: string}}\r\n\t\t */\r\n\t\tgetCoverStyle(faceName) {\r\n\t\t\tconst cover = this.getFaceCover(faceName)\r\n\t\t\tif (!cover) {\r\n\t\t\t\treturn {}\r\n\t\t\t}\r\n\t\t\tconst detections = cover.faceDetections\r\n\r\n\t\t\tconst detection = detections.find(detection => detection.title === faceName)\r\n\r\n\t\t\t// Zoom into the picture so that the face fills the --photos-face-width box nicely\r\n\t\t\t// if the face is larger than the image, we don't zoom out (reason for the Math.max)\r\n\t\t\tconst zoom = Math.max(1, (1 / detection.width) * 0.4)\r\n\r\n\t\t\tconst horizontalCenterOfFace = (detection.x + detection.width / 2) * 100\r\n\t\t\tconst verticalCenterOfFace = (detection.y + detection.height / 2) * 100\r\n\r\n\t\t\treturn {\r\n\t\t\t\t// We assume that the image is inside a div with width: var(--photos-face-width)\r\n\t\t\t\twidth: '100%',\r\n\t\t\t\t// we translate the image so that the center of the detected face is in the center of the --photos-face-width box\r\n\t\t\t\t// and add the zoom\r\n\t\t\t\ttransform: `translate(calc( var(--photos-face-width)/2 - ${horizontalCenterOfFace}% ), calc( var(--photos-face-width)/2 - ${verticalCenterOfFace}% )) scale(${zoom})`,\r\n\t\t\t\t// this is necessary for the zoom to zoom toward the center of the face\r\n\t\t\t\ttransformOrigin: `${horizontalCenterOfFace}% ${verticalCenterOfFace}%`,\r\n\t\t\t}\r\n\t\t},\r\n\t},\r\n}\r\n","/**\r\n * @copyright Copyright (c) 2022 Louis Chemineau <louis@chmn.me>\r\n *\r\n * @author Louis Chemineau <louis@chmn.me>\r\n *\r\n * @license AGPL-3.0-or-later\r\n *\r\n * This program is free software: you can redistribute it and/or modify\r\n * it under the terms of the GNU Affero General Public License as\r\n * published by the Free Software Foundation, either version 3 of the\r\n * License, or (at your option) any later version.\r\n *\r\n * This program is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\n * GNU Affero General Public License for more details.\r\n *\r\n * You should have received a copy of the GNU Affero General Public License\r\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\r\n *\r\n */\r\n\r\nimport { mapActions, mapGetters } from 'vuex'\r\n\r\nimport { showError } from '@nextcloud/dialogs'\r\nimport { getCurrentUser } from '@nextcloud/auth'\r\n\r\nimport client from '../services/DavClient.js'\r\nimport logger from '../services/logger.js'\r\nimport DavRequest from '../services/DavRequest'\r\nimport { genFileInfo } from '../utils/fileUtils'\r\nimport AbortControllerMixin from './AbortControllerMixin'\r\n\r\nexport default {\r\n\tname: 'FetchFacesMixin',\r\n\r\n\tdata() {\r\n\t\treturn {\r\n\t\t\terrorFetchingFaces: null,\r\n\t\t\tloadingFaces: false,\r\n\t\t\terrorFetchingFiles: null,\r\n\t\t\tloadingFiles: false,\r\n\t\t}\r\n\t},\r\n\r\n\tmixins: [\r\n\t\tAbortControllerMixin,\r\n\t],\r\n\r\n\tasync beforeMount() {\r\n\t\tthis.fetchFaces()\r\n\t},\r\n\r\n\tcomputed: {\r\n\t\t...mapGetters([\r\n\t\t\t'faces',\r\n\t\t]),\r\n\t},\r\n\r\n\tmethods: {\r\n\t\t...mapActions([\r\n\t\t\t'appendFiles',\r\n\t\t]),\r\n\r\n\t\tasync fetchFaces() {\r\n\t\t\tif (this.loadingFaces) {\r\n\t\t\t\treturn\r\n\t\t\t}\r\n\r\n\t\t\tif (Object.keys(this.faces).length) {\r\n\t\t\t\treturn\r\n\t\t\t}\r\n\r\n\t\t\ttry {\r\n\t\t\t\tthis.loadingFaces = true\r\n\t\t\t\tthis.errorFetchingFaces = null\r\n\r\n\t\t\t\tconst faces = await client.getDirectoryContents(`/recognize/${getCurrentUser()?.uid}/faces/`, {\r\n\t\t\t\t\tsignal: this.abortController.signal,\r\n\t\t\t\t})\r\n\t\t\t\tthis.$store.dispatch('addFaces', { faces })\r\n\t\t\t\tlogger.debug(`[FetchFacesMixin] Fetched ${faces.length} new faces: `, faces)\r\n\t\t\t} catch (error) {\r\n\t\t\t\tif (error.response && error.response.status) {\r\n\t\t\t\t\tif (error.response.status === 404) {\r\n\t\t\t\t\t\tthis.errorFetchingFaces = 404\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthis.errorFetchingFaces = error\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tlogger.error(t('photos', 'Failed to fetch faces list.'), { error })\r\n\t\t\t\tshowError(t('photos', 'Failed to fetch faces list.'))\r\n\t\t\t} finally {\r\n\t\t\t\tthis.loadingFaces = false\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tasync fetchFaceContent(faceName, force) {\r\n\t\t\tif (this.loadingFiles) {\r\n\t\t\t\treturn\r\n\t\t\t}\r\n\r\n\t\t\tif (!force && this.facesFiles[faceName] && this.facesFiles[faceName].length) {\r\n\t\t\t\treturn\r\n\t\t\t}\r\n\r\n\t\t\ttry {\r\n\t\t\t\tthis.errorFetchingFiles = null\r\n\t\t\t\tthis.loadingFiles = true\r\n\r\n\t\t\t\tlet { data: fetchedFiles } = await client.getDirectoryContents(\r\n\t\t\t\t\t`/recognize/${getCurrentUser()?.uid}/faces/${faceName}`,\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tdata: DavRequest,\r\n\t\t\t\t\t\tdetails: true,\r\n\t\t\t\t\t\tsignal: this.abortController.signal,\r\n\t\t\t\t\t}\r\n\t\t\t\t)\r\n\r\n\t\t\t\tfetchedFiles = fetchedFiles\r\n\t\t\t\t\t.map(file => genFileInfo(file))\r\n\t\t\t\t\t.map(file => ({ ...file, filename: file.realpath.replace(`/${getCurrentUser().uid}/files`, '') }))\r\n\r\n\t\t\t\tconst fileIds = fetchedFiles.map(file => '' + file.fileid)\r\n\r\n\t\t\t\tthis.appendFiles(fetchedFiles)\r\n\r\n\t\t\t\tif (fetchedFiles.length > 0) {\r\n\t\t\t\t\tawait this.$store.commit('addFilesToFace', { faceName, fileIdsToAdd: fileIds })\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlogger.debug(`[FetchFacesMixin] Fetched ${fileIds.length} new files: `, fileIds)\r\n\t\t\t} catch (error) {\r\n\t\t\t\tif (error.response && error.response.status) {\r\n\t\t\t\t\tif (error.response.status === 404) {\r\n\t\t\t\t\t\tthis.errorFetchingFiles = 404\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthis.errorFetchingFiles = error\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// cancelled request, moving on...\r\n\t\t\t\tlogger.error('Error fetching face files', { error })\r\n\t\t\t} finally {\r\n\t\t\t\tthis.loadingFiles = false\r\n\t\t\t}\r\n\t\t},\r\n\t},\r\n}\r\n","// Imports\nimport ___CSS_LOADER_API_SOURCEMAP_IMPORT___ from \"../../node_modules/css-loader/dist/runtime/sourceMaps.js\";\nimport ___CSS_LOADER_API_IMPORT___ from \"../../node_modules/css-loader/dist/runtime/api.js\";\nvar ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_SOURCEMAP_IMPORT___);\n// Module\n___CSS_LOADER_EXPORT___.push([module.id, \".face-cover[data-v-1f2ce110]{display:flex;flex-direction:column;padding:10px;border-radius:var(--border-radius-large)}.face-cover__crop-container[data-v-1f2ce110]{overflow:hidden;width:250px;height:250px;border-radius:250px;position:relative;background:var(--color-background-darker);--photos-face-width: 250px}@media only screen and (max-width: 1020px){.face-cover__crop-container[data-v-1f2ce110]{width:95px;height:95px;--photos-face-width: 95px}}.face-cover[data-v-1f2ce110]:hover,.face-cover[data-v-1f2ce110]:focus{background:var(--color-background-hover)}.face-cover__details[data-v-1f2ce110]{display:flex;flex-direction:column;width:250px;margin-top:4px;text-align:center}@media only screen and (max-width: 1020px){.face-cover__details[data-v-1f2ce110]{width:95px}}.face-cover__details__first-line[data-v-1f2ce110]{display:flex;height:2em;overflow:hidden;text-overflow:ellipsis}.face-cover__details__second-line[data-v-1f2ce110]{margin-top:6px;color:var(--color-text-maxcontrast)}.face-cover__details__name[data-v-1f2ce110]{flex-grow:1;margin:0}\", \"\",{\"version\":3,\"sources\":[\"webpack://./src/components/FaceCover.vue\"],\"names\":[],\"mappings\":\"AAmHA,6BACC,YAAA,CACA,qBAAA,CACA,YAAA,CACA,wCAAA,CAEA,6CACC,eAAA,CACA,WAAA,CACA,YAAA,CACA,mBAAA,CACA,iBAAA,CACA,yCAAA,CACA,0BAAA,CAEA,2CATD,6CAUE,UAAA,CACA,WAAA,CACA,yBAAA,CAAA,CAIF,sEACC,wCAAA,CAGD,sCACC,YAAA,CACA,qBAAA,CACA,WAAA,CACA,cAAA,CACA,iBAAA,CAEA,2CAPD,sCAQE,UAAA,CAAA,CAGD,kDACC,YAAA,CACA,UAAA,CACA,eAAA,CACA,sBAAA,CAGD,mDACC,cAAA,CACA,mCAAA,CAGD,4CACC,WAAA,CACA,QAAA\",\"sourcesContent\":[\"$sizes: (\\\"400\\\": (\\\"count\\\": 3, \\\"marginTop\\\": 66, \\\"marginW\\\": 8), \\\"700\\\": (\\\"count\\\": 4, \\\"marginTop\\\": 66, \\\"marginW\\\": 8), \\\"1024\\\": (\\\"count\\\": 5, \\\"marginTop\\\": 66, \\\"marginW\\\": 44), \\\"1280\\\": (\\\"count\\\": 4, \\\"marginTop\\\": 66, \\\"marginW\\\": 44), \\\"1440\\\": (\\\"count\\\": 5, \\\"marginTop\\\": 88, \\\"marginW\\\": 66), \\\"1600\\\": (\\\"count\\\": 6, \\\"marginTop\\\": 88, \\\"marginW\\\": 66), \\\"2048\\\": (\\\"count\\\": 7, \\\"marginTop\\\": 88, \\\"marginW\\\": 66), \\\"2560\\\": (\\\"count\\\": 8, \\\"marginTop\\\": 88, \\\"marginW\\\": 88), \\\"3440\\\": (\\\"count\\\": 9, \\\"marginTop\\\": 88, \\\"marginW\\\": 88), \\\"max\\\": (\\\"count\\\": 10, \\\"marginTop\\\": 88, \\\"marginW\\\": 88));\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\r\\n.face-cover {\\r\\n\\tdisplay: flex;\\r\\n\\tflex-direction: column;\\r\\n\\tpadding: 10px;\\r\\n\\tborder-radius: var(--border-radius-large);\\r\\n\\r\\n\\t&__crop-container {\\r\\n\\t\\toverflow: hidden;\\r\\n\\t\\twidth: 250px;\\r\\n\\t\\theight: 250px;\\r\\n\\t\\tborder-radius: 250px;\\r\\n\\t\\tposition: relative;\\r\\n\\t\\tbackground: var(--color-background-darker);\\r\\n\\t\\t--photos-face-width: 250px;\\r\\n\\r\\n\\t\\t@media only screen and (max-width: 1020px) {\\r\\n\\t\\t\\twidth: 95px;\\r\\n\\t\\t\\theight: 95px;\\r\\n\\t\\t\\t--photos-face-width: 95px;\\r\\n\\t\\t}\\r\\n\\t}\\r\\n\\r\\n\\t&:hover, &:focus {\\r\\n\\t\\tbackground: var(--color-background-hover);\\r\\n\\t}\\r\\n\\r\\n\\t&__details {\\r\\n\\t\\tdisplay: flex;\\r\\n\\t\\tflex-direction: column;\\r\\n\\t\\twidth: 250px;\\r\\n\\t\\tmargin-top: 4px;\\r\\n\\t\\ttext-align: center;\\r\\n\\r\\n\\t\\t@media only screen and (max-width: 1020px) {\\r\\n\\t\\t\\twidth: 95px;\\r\\n\\t\\t}\\r\\n\\r\\n\\t\\t&__first-line {\\r\\n\\t\\t\\tdisplay: flex;\\r\\n\\t\\t\\theight: 2em;\\r\\n\\t\\t\\toverflow: hidden;\\r\\n\\t\\t\\ttext-overflow: ellipsis;\\r\\n\\t\\t}\\r\\n\\r\\n\\t\\t&__second-line {\\r\\n\\t\\t\\tmargin-top: 6px;\\r\\n\\t\\t\\tcolor: var(--color-text-maxcontrast);\\r\\n\\t\\t}\\r\\n\\r\\n\\t\\t&__name {\\r\\n\\t\\t\\tflex-grow: 1;\\r\\n\\t\\t\\tmargin: 0;\\r\\n\\t\\t}\\r\\n\\t}\\r\\n}\\r\\n\"],\"sourceRoot\":\"\"}]);\n// Exports\nexport default ___CSS_LOADER_EXPORT___;\n","// Imports\nimport ___CSS_LOADER_API_SOURCEMAP_IMPORT___ from \"../../node_modules/css-loader/dist/runtime/sourceMaps.js\";\nimport ___CSS_LOADER_API_IMPORT___ from \"../../node_modules/css-loader/dist/runtime/api.js\";\nvar ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_SOURCEMAP_IMPORT___);\n// Module\n___CSS_LOADER_EXPORT___.push([module.id, \".faces[data-v-41711a97]{display:flex;flex-direction:column;height:calc(100vh - var(--header-height));padding-left:64px}@media only screen and (max-width: 1020px){.faces[data-v-41711a97]{padding:0}}.faces__header[data-v-41711a97]{display:flex;min-height:60px;align-items:center}.faces__header button[data-v-41711a97]{margin-right:32px}.faces__list[data-v-41711a97]{padding-top:24px;padding-bottom:32px;flex-grow:1;display:flex;flex-wrap:wrap;gap:32px;align-content:flex-start}.faces__empty[data-v-41711a97]{display:flex;flex-direction:column;align-items:center}.faces__empty__button[data-v-41711a97]{margin-top:32px}.empty-content-with-illustration[data-v-41711a97]  .empty-content__icon{width:200px;height:200px}.empty-content-with-illustration[data-v-41711a97]  .empty-content__icon svg{width:200px;height:200px}\", \"\",{\"version\":3,\"sources\":[\"webpack://./src/views/Faces.vue\"],\"names\":[],\"mappings\":\"AAqGA,wBACC,YAAA,CACA,qBAAA,CACA,yCAAA,CACA,iBAAA,CAEA,2CAND,wBAOE,SAAA,CAAA,CAGD,gCACC,YAAA,CACA,eAAA,CACA,kBAAA,CAEA,uCACC,iBAAA,CAIF,8BACC,gBAAA,CACA,mBAAA,CACA,WAAA,CACA,YAAA,CACA,cAAA,CACA,QAAA,CACA,wBAAA,CAGD,+BACC,YAAA,CACA,qBAAA,CACA,kBAAA,CAEA,uCACC,eAAA,CAKH,wEACC,WAAA,CACA,YAAA,CAEA,4EACC,WAAA,CACA,YAAA\",\"sourcesContent\":[\"$sizes: (\\\"400\\\": (\\\"count\\\": 3, \\\"marginTop\\\": 66, \\\"marginW\\\": 8), \\\"700\\\": (\\\"count\\\": 4, \\\"marginTop\\\": 66, \\\"marginW\\\": 8), \\\"1024\\\": (\\\"count\\\": 5, \\\"marginTop\\\": 66, \\\"marginW\\\": 44), \\\"1280\\\": (\\\"count\\\": 4, \\\"marginTop\\\": 66, \\\"marginW\\\": 44), \\\"1440\\\": (\\\"count\\\": 5, \\\"marginTop\\\": 88, \\\"marginW\\\": 66), \\\"1600\\\": (\\\"count\\\": 6, \\\"marginTop\\\": 88, \\\"marginW\\\": 66), \\\"2048\\\": (\\\"count\\\": 7, \\\"marginTop\\\": 88, \\\"marginW\\\": 66), \\\"2560\\\": (\\\"count\\\": 8, \\\"marginTop\\\": 88, \\\"marginW\\\": 88), \\\"3440\\\": (\\\"count\\\": 9, \\\"marginTop\\\": 88, \\\"marginW\\\": 88), \\\"max\\\": (\\\"count\\\": 10, \\\"marginTop\\\": 88, \\\"marginW\\\": 88));\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\r\\n.faces {\\r\\n\\tdisplay: flex;\\r\\n\\tflex-direction: column;\\r\\n\\theight: calc(100vh - var(--header-height));\\r\\n\\tpadding-left: 64px;\\r\\n\\r\\n\\t@media only screen and (max-width: 1020px) {\\r\\n\\t\\tpadding: 0;\\r\\n\\t}\\r\\n\\r\\n\\t&__header {\\r\\n\\t\\tdisplay: flex;\\r\\n\\t\\tmin-height: 60px;\\r\\n\\t\\talign-items: center;\\r\\n\\r\\n\\t\\tbutton {\\r\\n\\t\\t\\tmargin-right: 32px;\\r\\n\\t\\t}\\r\\n\\t}\\r\\n\\r\\n\\t&__list {\\r\\n\\t\\tpadding-top: 24px;\\r\\n\\t\\tpadding-bottom: 32px;\\r\\n\\t\\tflex-grow: 1;\\r\\n\\t\\tdisplay: flex;\\r\\n\\t\\tflex-wrap: wrap;\\r\\n\\t\\tgap: 32px;\\r\\n\\t\\talign-content: flex-start;\\r\\n\\t}\\r\\n\\r\\n\\t&__empty {\\r\\n\\t\\tdisplay: flex;\\r\\n\\t\\tflex-direction: column;\\r\\n\\t\\talign-items: center;\\r\\n\\r\\n\\t\\t&__button {\\r\\n\\t\\t\\tmargin-top: 32px;\\r\\n\\t\\t}\\r\\n\\t}\\r\\n}\\r\\n\\r\\n.empty-content-with-illustration ::v-deep .empty-content__icon {\\r\\n\\twidth: 200px;\\r\\n\\theight: 200px;\\r\\n\\r\\n\\tsvg {\\r\\n\\t\\twidth: 200px;\\r\\n\\t\\theight: 200px;\\r\\n\\t}\\r\\n}\\r\\n\"],\"sourceRoot\":\"\"}]);\n// Exports\nexport default ___CSS_LOADER_EXPORT___;\n","<template>\n  <span v-bind=\"$attrs\"\n        :aria-hidden=\"!title\"\n        :aria-label=\"title\"\n        class=\"material-design-icon account-box-multiple-outline-icon\"\n        role=\"img\"\n        @click=\"$emit('click', $event)\">\n    <svg :fill=\"fillColor\"\n         class=\"material-design-icon__svg\"\n         :width=\"size\"\n         :height=\"size\"\n         viewBox=\"0 0 24 24\">\n      <path d=\"M4 6H2V20C2 21.11 2.9 22 4 22H18V20H4V6M18.5 14.25C18.5 12.75 15.5 12 14 12S9.5 12.75 9.5 14.25V15H18.5M14 10.25C15.24 10.25 16.25 9.24 16.25 8S15.24 5.75 14 5.75 11.75 6.76 11.75 8 12.76 10.25 14 10.25M20 2H8C6.9 2 6 2.9 6 4V16C6 17.11 6.9 18 8 18H20C21.11 18 22 17.11 22 16V4C22 2.89 21.1 2 20 2M20 16H8V4H20V16Z\">\n        <title v-if=\"title\">{{ title }}</title>\n      </path>\n    </svg>\n  </span>\n</template>\n\n<script>\nexport default {\n  name: \"AccountBoxMultipleOutlineIcon\",\n  emits: ['click'],\n  props: {\n    title: {\n      type: String,\n    },\n    fillColor: {\n      type: String,\n      default: \"currentColor\"\n    },\n    size: {\n      type: Number,\n      default: 24\n    }\n  }\n}\n</script>","import mod from \"-!../vue-loader/lib/index.js??vue-loader-options!./AccountBoxMultipleOutline.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../vue-loader/lib/index.js??vue-loader-options!./AccountBoxMultipleOutline.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./AccountBoxMultipleOutline.vue?vue&type=template&id=6bcc1fce&\"\nimport script from \"./AccountBoxMultipleOutline.vue?vue&type=script&lang=js&\"\nexport * from \"./AccountBoxMultipleOutline.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('span',_vm._b({staticClass:\"material-design-icon account-box-multiple-outline-icon\",attrs:{\"aria-hidden\":!_vm.title,\"aria-label\":_vm.title,\"role\":\"img\"},on:{\"click\":function($event){return _vm.$emit('click', $event)}}},'span',_vm.$attrs,false),[_c('svg',{staticClass:\"material-design-icon__svg\",attrs:{\"fill\":_vm.fillColor,\"width\":_vm.size,\"height\":_vm.size,\"viewBox\":\"0 0 24 24\"}},[_c('path',{attrs:{\"d\":\"M4 6H2V20C2 21.11 2.9 22 4 22H18V20H4V6M18.5 14.25C18.5 12.75 15.5 12 14 12S9.5 12.75 9.5 14.25V15H18.5M14 10.25C15.24 10.25 16.25 9.24 16.25 8S15.24 5.75 14 5.75 11.75 6.76 11.75 8 12.76 10.25 14 10.25M20 2H8C6.9 2 6 2.9 6 4V16C6 17.11 6.9 18 8 18H20C21.11 18 22 17.11 22 16V4C22 2.89 21.1 2 20 2M20 16H8V4H20V16Z\"}},[(_vm.title)?_c('title',[_vm._v(_vm._s(_vm.title))]):_vm._e()])])])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return (_vm.errorFetchingFaces)?_c('NcEmptyContent',[_vm._v(\"\\n\\t\"+_vm._s(_vm.t('photos', 'An error occurred'))+\"\\n\")]):_c('div',{staticClass:\"faces\"},[(_vm.loadingFaces)?_c('NcLoadingIcon'):_vm._e(),_vm._v(\" \"),(_vm.noFaces && !_vm.loadingFaces)?_c('div',{staticClass:\"faces__empty\"},[_c('NcEmptyContent',{staticClass:\"empty-content-with-illustration\",scopedSlots:_vm._u([{key:\"icon\",fn:function(){return [_c('AccountBoxMultipleOutline')]},proxy:true},{key:\"desc\",fn:function(){return [_vm._v(\"\\n\\t\\t\\t\\t\"+_vm._s(_vm.t('photos', 'This might take some time depending on the size of your photo library.'))+\"\\n\\t\\t\\t\")]},proxy:true}],null,false,3796275108)},[_vm._v(\" \"),_vm._v(\"\\n\\t\\t\\t\"+_vm._s(_vm.t('photos', 'Recognized people will show up here'))+\"\\n\\t\\t\")])],1):(!_vm.noFaces)?_c('div',{staticClass:\"faces__list\"},_vm._l((_vm.orderedFaces),function(face){return _c('FaceCover',{key:face.basename,attrs:{\"base-name\":face.basename}})}),1):_vm._e()],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<!--\r\n - @copyright Copyright (c) 2022 Louis Chemineau <louis@chmn.me>\r\n - @copyright Copyright (c) 2022 Marcel Klehr <mklehr@gmx.net>\r\n -\r\n - @author Louis Chemineau <louis@chmn.me>\r\n - @author Marcel Klehr <mklehr@gmx.net>\r\n -\r\n - @license AGPL-3.0-or-later\r\n -\r\n - This program is free software: you can redistribute it and/or modify\r\n - it under the terms of the GNU Affero General Public License as\r\n - published by the Free Software Foundation, either version 3 of the\r\n - License, or (at your option) any later version.\r\n -\r\n - This program is distributed in the hope that it will be useful,\r\n - but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n - MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\n - GNU Affero General Public License for more details.\r\n -\r\n - You should have received a copy of the GNU Affero General Public License\r\n - along with this program. If not, see <http://www.gnu.org/licenses/>.\r\n -\r\n -->\r\n\r\n<template>\r\n\t<router-link class=\"face-cover\" :to=\"`/faces/${baseName}`\">\r\n\t\t<div class=\"face-cover__crop-container\">\r\n\t\t\t<img ref=\"image\"\r\n\t\t\t\tclass=\"face-cover__image\"\r\n\t\t\t\t:src=\"coverUrl\"\r\n\t\t\t\t:style=\"coverDimensions\">\r\n\t\t</div>\r\n\t\t<div class=\"face-cover__details\">\r\n\t\t\t<div v-if=\"!baseName.match(/^[0-9]+$/)\" class=\"face-cover__details__first-line\">\r\n\t\t\t\t<h2 class=\"face-cover__details__name\">\r\n\t\t\t\t\t{{ baseName }}\r\n\t\t\t\t</h2>\r\n\t\t\t</div>\r\n\t\t\t<div v-if=\"facesFiles[baseName]\" class=\"face-cover__details__second-line\">\r\n\t\t\t\t{{ n('photos', '%n photos', '%n photos', facesFiles[baseName].length,) }}\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t</router-link>\r\n</template>\r\n\r\n<script>\r\nimport { mapGetters } from 'vuex'\r\nimport { generateUrl } from '@nextcloud/router'\r\nimport FetchFacesMixin from '../mixins/FetchFacesMixin.js'\r\nimport FaceCoverMixin from '../mixins/FaceCoverMixin.js'\r\n\r\nexport default {\r\n\tname: 'FaceCover',\r\n\r\n\tmixins: [\r\n\t\tFetchFacesMixin,\r\n\t\tFaceCoverMixin,\r\n\t],\r\n\r\n\tprops: {\r\n\t\tbaseName: {\r\n\t\t\ttype: String,\r\n\t\t\trequired: true,\r\n\t\t},\r\n\t},\r\n\r\n\tcomputed: {\r\n\t\t...mapGetters([\r\n\t\t\t'files',\r\n\t\t\t'faces',\r\n\t\t\t'facesFiles',\r\n\t\t]),\r\n\r\n\t\t/**\r\n\t\t * @return {Face}\r\n\t\t */\r\n\t\tface() {\r\n\t\t\treturn this.faces[this.baseName]\r\n\t\t},\r\n\r\n\t\t/**\r\n\t\t * @return {string}\r\n\t\t */\r\n\t\tcoverUrl() {\r\n\t\t\tif (!this.cover) {\r\n\t\t\t\treturn ''\r\n\t\t\t}\r\n\r\n\t\t\treturn generateUrl(`/apps/photos/api/v1/preview/${this.cover.fileid}?x=${512}&y=${512}`)\r\n\t\t},\r\n\r\n\t\tcover() {\r\n\t\t\treturn this.getFaceCover(this.face.basename)\r\n\t\t},\r\n\r\n\t\tcoverDimensions() {\r\n\t\t\tif (!this.cover) return {}\r\n\t\t\treturn this.getCoverStyle(this.face.basename)\r\n\t\t},\r\n\t},\r\n\r\n\tasync beforeMount() {\r\n\t\tawait this.fetchFiles()\r\n\t},\r\n\r\n\tmethods: {\r\n\t\tasync fetchFiles() {\r\n\t\t\tawait this.fetchFaceContent(this.face.basename)\r\n\t\t},\r\n\t},\r\n}\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n.face-cover {\r\n\tdisplay: flex;\r\n\tflex-direction: column;\r\n\tpadding: 10px;\r\n\tborder-radius: var(--border-radius-large);\r\n\r\n\t&__crop-container {\r\n\t\toverflow: hidden;\r\n\t\twidth: 250px;\r\n\t\theight: 250px;\r\n\t\tborder-radius: 250px;\r\n\t\tposition: relative;\r\n\t\tbackground: var(--color-background-darker);\r\n\t\t--photos-face-width: 250px;\r\n\r\n\t\t@media only screen and (max-width: 1020px) {\r\n\t\t\twidth: 95px;\r\n\t\t\theight: 95px;\r\n\t\t\t--photos-face-width: 95px;\r\n\t\t}\r\n\t}\r\n\r\n\t&:hover, &:focus {\r\n\t\tbackground: var(--color-background-hover);\r\n\t}\r\n\r\n\t&__details {\r\n\t\tdisplay: flex;\r\n\t\tflex-direction: column;\r\n\t\twidth: 250px;\r\n\t\tmargin-top: 4px;\r\n\t\ttext-align: center;\r\n\r\n\t\t@media only screen and (max-width: 1020px) {\r\n\t\t\twidth: 95px;\r\n\t\t}\r\n\r\n\t\t&__first-line {\r\n\t\t\tdisplay: flex;\r\n\t\t\theight: 2em;\r\n\t\t\toverflow: hidden;\r\n\t\t\ttext-overflow: ellipsis;\r\n\t\t}\r\n\r\n\t\t&__second-line {\r\n\t\t\tmargin-top: 6px;\r\n\t\t\tcolor: var(--color-text-maxcontrast);\r\n\t\t}\r\n\r\n\t\t&__name {\r\n\t\t\tflex-grow: 1;\r\n\t\t\tmargin: 0;\r\n\t\t}\r\n\t}\r\n}\r\n</style>\r\n","import mod from \"-!../../node_modules/babel-loader/lib/index.js!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./FaceCover.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/babel-loader/lib/index.js!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./FaceCover.vue?vue&type=script&lang=js&\"","\n      import API from \"!../../node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js\";\n      import domAPI from \"!../../node_modules/style-loader/dist/runtime/styleDomAPI.js\";\n      import insertFn from \"!../../node_modules/style-loader/dist/runtime/insertBySelector.js\";\n      import setAttributes from \"!../../node_modules/style-loader/dist/runtime/setAttributesWithoutAttributes.js\";\n      import insertStyleElement from \"!../../node_modules/style-loader/dist/runtime/insertStyleElement.js\";\n      import styleTagTransformFn from \"!../../node_modules/style-loader/dist/runtime/styleTagTransform.js\";\n      import content, * as namedExport from \"!!../../node_modules/css-loader/dist/cjs.js!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/dist/cjs.js!../../node_modules/sass-loader/dist/cjs.js??clonedRuleSet-2[0].rules[0].use[3]!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./FaceCover.vue?vue&type=style&index=0&id=1f2ce110&lang=scss&scoped=true&\";\n      \n      \n\nvar options = {};\n\noptions.styleTagTransform = styleTagTransformFn;\noptions.setAttributes = setAttributes;\n\n      options.insert = insertFn.bind(null, \"head\");\n    \noptions.domAPI = domAPI;\noptions.insertStyleElement = insertStyleElement;\n\nvar update = API(content, options);\n\n\n\nexport * from \"!!../../node_modules/css-loader/dist/cjs.js!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/dist/cjs.js!../../node_modules/sass-loader/dist/cjs.js??clonedRuleSet-2[0].rules[0].use[3]!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./FaceCover.vue?vue&type=style&index=0&id=1f2ce110&lang=scss&scoped=true&\";\n       export default content && content.locals ? content.locals : undefined;\n","<!--\r\n - @copyright Copyright (c) 2022 Louis Chemineau <louis@chmn.me>\r\n - @copyright Copyright (c) 2022 Marcel Klehr <mklehr@gmx.net>\r\n -\r\n - @author Louis Chemineau <louis@chmn.me>\r\n - @author Marcel Klehr <mklehr@gmx.net>\r\n -\r\n - @license AGPL-3.0-or-later\r\n -\r\n - This program is free software: you can redistribute it and/or modify\r\n - it under the terms of the GNU Affero General Public License as\r\n - published by the Free Software Foundation, either version 3 of the\r\n - License, or (at your option) any later version.\r\n -\r\n - This program is distributed in the hope that it will be useful,\r\n - but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n - MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\n - GNU Affero General Public License for more details.\r\n -\r\n - You should have received a copy of the GNU Affero General Public License\r\n - along with this program. If not, see <http://www.gnu.org/licenses/>.\r\n -\r\n -->\r\n<template>\r\n\t<!-- Errors handlers-->\r\n\t<NcEmptyContent v-if=\"errorFetchingFaces\">\r\n\t\t{{ t('photos', 'An error occurred') }}\r\n\t</NcEmptyContent>\r\n\r\n\t<!-- Face list -->\r\n\t<div v-else class=\"faces\">\r\n\t\t<NcLoadingIcon v-if=\"loadingFaces\" />\r\n\r\n\t\t<!-- No faces -->\r\n\t\t<div v-if=\"noFaces && !loadingFaces\" class=\"faces__empty\">\r\n\t\t\t<NcEmptyContent class=\"empty-content-with-illustration\">\r\n\t\t\t\t<template #icon>\r\n\t\t\t\t\t<AccountBoxMultipleOutline />\r\n\t\t\t\t</template>\r\n\t\t\t\t<template #desc>\r\n\t\t\t\t\t{{ t('photos', 'This might take some time depending on the size of your photo library.') }}\r\n\t\t\t\t</template>\r\n\t\t\t\t{{ t('photos', 'Recognized people will show up here') }}\r\n\t\t\t</NcEmptyContent>\r\n\t\t</div>\r\n\r\n\t\t<div v-else-if=\"!noFaces\" class=\"faces__list\">\r\n\t\t\t<FaceCover v-for=\"face in orderedFaces\"\r\n\t\t\t\t:key=\"face.basename\"\r\n\t\t\t\t:base-name=\"face.basename\" />\r\n\t\t</div>\r\n\t</div>\r\n</template>\r\n\r\n<script>\r\nimport AccountBoxMultipleOutline from 'vue-material-design-icons/AccountBoxMultipleOutline'\r\n\r\nimport { NcEmptyContent, NcLoadingIcon } from '@nextcloud/vue'\r\n\r\nimport FetchFacesMixin from '../mixins/FetchFacesMixin.js'\r\nimport FaceCover from '../components/FaceCover.vue'\r\nimport { mapGetters } from 'vuex'\r\n\r\nexport default {\r\n\tname: 'Faces',\r\n\tcomponents: {\r\n\t\tFaceCover,\r\n\t\tNcEmptyContent,\r\n\t\tNcLoadingIcon,\r\n\t\tAccountBoxMultipleOutline,\r\n\t},\r\n\r\n\tmixins: [\r\n\t\tFetchFacesMixin,\r\n\t],\r\n\r\n\tcomputed: {\r\n\t\t...mapGetters([\r\n\t\t\t'facesFiles',\r\n\t\t]),\r\n\r\n\t\t/**\r\n\t\t * @return {boolean} Whether the list of face is empty or not.\r\n\t\t */\r\n\t\tnoFaces() {\r\n\t\t\treturn Object.keys(this.faces).length === 0\r\n\t\t},\r\n\r\n\t\torderedFaces() {\r\n\t\t\treturn Object.values(this.faces).sort((a, b) => {\r\n\t\t\t\tif (!this.facesFiles[b.basename] || !this.facesFiles[a.basename]) {\r\n\t\t\t\t\treturn 0\r\n\t\t\t\t}\r\n\t\t\t\treturn this.facesFiles[b.basename].length - this.facesFiles[a.basename].length\r\n\t\t\t})\r\n\t\t},\r\n\t},\r\n}\r\n</script>\r\n<style lang=\"scss\" scoped>\r\n.faces {\r\n\tdisplay: flex;\r\n\tflex-direction: column;\r\n\theight: calc(100vh - var(--header-height));\r\n\tpadding-left: 64px;\r\n\r\n\t@media only screen and (max-width: 1020px) {\r\n\t\tpadding: 0;\r\n\t}\r\n\r\n\t&__header {\r\n\t\tdisplay: flex;\r\n\t\tmin-height: 60px;\r\n\t\talign-items: center;\r\n\r\n\t\tbutton {\r\n\t\t\tmargin-right: 32px;\r\n\t\t}\r\n\t}\r\n\r\n\t&__list {\r\n\t\tpadding-top: 24px;\r\n\t\tpadding-bottom: 32px;\r\n\t\tflex-grow: 1;\r\n\t\tdisplay: flex;\r\n\t\tflex-wrap: wrap;\r\n\t\tgap: 32px;\r\n\t\talign-content: flex-start;\r\n\t}\r\n\r\n\t&__empty {\r\n\t\tdisplay: flex;\r\n\t\tflex-direction: column;\r\n\t\talign-items: center;\r\n\r\n\t\t&__button {\r\n\t\t\tmargin-top: 32px;\r\n\t\t}\r\n\t}\r\n}\r\n\r\n.empty-content-with-illustration ::v-deep .empty-content__icon {\r\n\twidth: 200px;\r\n\theight: 200px;\r\n\r\n\tsvg {\r\n\t\twidth: 200px;\r\n\t\theight: 200px;\r\n\t}\r\n}\r\n</style>\r\n","import mod from \"-!../../node_modules/babel-loader/lib/index.js!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Faces.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/babel-loader/lib/index.js!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Faces.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./FaceCover.vue?vue&type=template&id=1f2ce110&scoped=true&\"\nimport script from \"./FaceCover.vue?vue&type=script&lang=js&\"\nexport * from \"./FaceCover.vue?vue&type=script&lang=js&\"\nimport style0 from \"./FaceCover.vue?vue&type=style&index=0&id=1f2ce110&lang=scss&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"1f2ce110\",\n  null\n  \n)\n\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('router-link',{staticClass:\"face-cover\",attrs:{\"to\":(\"/faces/\" + _vm.baseName)}},[_c('div',{staticClass:\"face-cover__crop-container\"},[_c('img',{ref:\"image\",staticClass:\"face-cover__image\",style:(_vm.coverDimensions),attrs:{\"src\":_vm.coverUrl}})]),_vm._v(\" \"),_c('div',{staticClass:\"face-cover__details\"},[(!_vm.baseName.match(/^[0-9]+$/))?_c('div',{staticClass:\"face-cover__details__first-line\"},[_c('h2',{staticClass:\"face-cover__details__name\"},[_vm._v(\"\\n\\t\\t\\t\\t\"+_vm._s(_vm.baseName)+\"\\n\\t\\t\\t\")])]):_vm._e(),_vm._v(\" \"),(_vm.facesFiles[_vm.baseName])?_c('div',{staticClass:\"face-cover__details__second-line\"},[_vm._v(\"\\n\\t\\t\\t\"+_vm._s(_vm.n('photos', '%n photos', '%n photos', _vm.facesFiles[_vm.baseName].length))+\"\\n\\t\\t\")]):_vm._e()])])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","\n      import API from \"!../../node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js\";\n      import domAPI from \"!../../node_modules/style-loader/dist/runtime/styleDomAPI.js\";\n      import insertFn from \"!../../node_modules/style-loader/dist/runtime/insertBySelector.js\";\n      import setAttributes from \"!../../node_modules/style-loader/dist/runtime/setAttributesWithoutAttributes.js\";\n      import insertStyleElement from \"!../../node_modules/style-loader/dist/runtime/insertStyleElement.js\";\n      import styleTagTransformFn from \"!../../node_modules/style-loader/dist/runtime/styleTagTransform.js\";\n      import content, * as namedExport from \"!!../../node_modules/css-loader/dist/cjs.js!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/dist/cjs.js!../../node_modules/sass-loader/dist/cjs.js??clonedRuleSet-2[0].rules[0].use[3]!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Faces.vue?vue&type=style&index=0&id=41711a97&lang=scss&scoped=true&\";\n      \n      \n\nvar options = {};\n\noptions.styleTagTransform = styleTagTransformFn;\noptions.setAttributes = setAttributes;\n\n      options.insert = insertFn.bind(null, \"head\");\n    \noptions.domAPI = domAPI;\noptions.insertStyleElement = insertStyleElement;\n\nvar update = API(content, options);\n\n\n\nexport * from \"!!../../node_modules/css-loader/dist/cjs.js!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/dist/cjs.js!../../node_modules/sass-loader/dist/cjs.js??clonedRuleSet-2[0].rules[0].use[3]!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Faces.vue?vue&type=style&index=0&id=41711a97&lang=scss&scoped=true&\";\n       export default content && content.locals ? content.locals : undefined;\n","import { render, staticRenderFns } from \"./Faces.vue?vue&type=template&id=41711a97&scoped=true&\"\nimport script from \"./Faces.vue?vue&type=script&lang=js&\"\nexport * from \"./Faces.vue?vue&type=script&lang=js&\"\nimport style0 from \"./Faces.vue?vue&type=style&index=0&id=41711a97&lang=scss&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"41711a97\",\n  null\n  \n)\n\nexport default component.exports"],"names":["name","data","abortController","AbortController","beforeDestroy","this","abort","beforeRouteLeave","from","to","next","computed","mapGetters","methods","getFaceCover","faceName","scoreFacePosition","faceDetection","Math","max","x","width","y","height","facesFiles","slice","map","fileId","files","file","faceDetections","JSON","parse","he","sort","a","b","find","d","title","length","getCoverStyle","cover","detection","zoom","horizontalCenterOfFace","verticalCenterOfFace","transform","transformOrigin","errorFetchingFaces","loadingFaces","errorFetchingFiles","loadingFiles","mixins","AbortControllerMixin","beforeMount","fetchFaces","mapActions","Object","keys","faces","client","getCurrentUser","uid","signal","$store","dispatch","logger","response","status","t","error","showError","fetchFaceContent","force","DavRequest","details","fetchedFiles","genFileInfo","filename","realpath","replace","fileIds","fileid","appendFiles","commit","fileIdsToAdd","___CSS_LOADER_EXPORT___","push","module","id","emits","props","type","String","fillColor","default","size","Number","_vm","_h","$createElement","_c","_self","_b","staticClass","attrs","on","$event","$emit","$attrs","_v","_s","_e","options","styleTagTransform","setAttributes","insert","domAPI","insertStyleElement","baseName","ref","style","coverUrl","match","n","noFaces","scopedSlots","_u","key","fn","proxy","_l","face","basename"],"sourceRoot":""}