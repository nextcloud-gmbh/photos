/*! For license information please see photos-src_mixins_FetchAlbumsMixin_js-src_components_Albums_AlbumForm_vue.js.LICENSE.txt */
"use strict";(self.webpackChunkphotos=self.webpackChunkphotos||[]).push([["src_mixins_FetchAlbumsMixin_js-src_components_Albums_AlbumForm_vue"],{12945:(n,t,r)=>{r.d(t,{Z:()=>p});var e=r(20629),o=r(45994),a=r(69363),l=r(99622);function i(n,t){var r=Object.keys(n);if(Object.getOwnPropertySymbols){var e=Object.getOwnPropertySymbols(n);t&&(e=e.filter((function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),r.push.apply(r,e)}return r}function s(n){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?i(Object(r),!0).forEach((function(t){c(n,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach((function(t){Object.defineProperty(n,t,Object.getOwnPropertyDescriptor(r,t))}))}return n}function c(n,t,r){return t in n?Object.defineProperty(n,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):n[t]=r,n}function u(n,t,r,e,o,a,l){try{var i=n[a](l),s=i.value}catch(n){return void r(n)}i.done?t(s):Promise.resolve(s).then(e,o)}function b(n){return function(){var t=this,r=arguments;return new Promise((function(e,o){var a=n.apply(t,r);function l(n){u(a,e,o,l,i,"next",n)}function i(n){u(a,e,o,l,i,"throw",n)}l(void 0)}))}}const p={name:"FetchAlbumsMixin",data:function(){return{errorFetchingAlbums:null,loadingAlbums:!1}},mixins:[a.Z],beforeMount:function(){var n=this;return b(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n.fetchAlbums();case 1:case"end":return t.stop()}}),t)})))()},computed:s({},(0,e.Se)(["albums"])),methods:s(s({},(0,e.nv)(["addAlbums"])),{},{fetchAlbums:function(){var n=this;return b(regeneratorRuntime.mark((function t(){var r,e,a;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!n.loadingAlbums){t.next=2;break}return t.abrupt("return");case 2:return t.prev=2,n.loadingAlbums=!0,n.errorFetchingAlbums=null,t.next=7,(0,l.CE)("/photos/".concat(null===(r=(0,o.ts)())||void 0===r?void 0:r.uid,"/albums"),n.abortController.signal);case 7:e=t.sent,n.addAlbums({albums:e}),t.next=14;break;case 11:t.prev=11,t.t0=t.catch(2),404===(null===(a=t.t0.response)||void 0===a?void 0:a.status)?n.errorFetchingAlbums=404:n.errorFetchingAlbums=t.t0;case 14:return t.prev=14,n.loadingAlbums=!1,t.finish(14);case 17:case"end":return t.stop()}}),t,null,[[2,11,14,17]])})))()}})}},62116:(n,t,r)=>{r.d(t,{Z:()=>i});var e=r(87537),o=r.n(e),a=r(23645),l=r.n(a)()(o());l.push([n.id,".album-form[data-v-5bc188a2]{display:flex;flex-direction:column;height:350px;padding:16px}.album-form .form-title[data-v-5bc188a2]{font-weight:bold}.album-form .form-subtitle[data-v-5bc188a2]{color:var(--color-text-lighter)}.album-form .form-inputs[data-v-5bc188a2]{flex-grow:1;justify-items:flex-end}.album-form .form-inputs input[data-v-5bc188a2]{width:100%}.album-form .form-inputs label[data-v-5bc188a2]{display:flex;margin-top:16px}.album-form .form-inputs label[data-v-5bc188a2]  svg{margin-right:12px}.album-form .form-buttons[data-v-5bc188a2]{display:flex;justify-content:space-between}.album-form .form-buttons .left-buttons[data-v-5bc188a2],.album-form .form-buttons .right-buttons[data-v-5bc188a2]{display:flex}.album-form .form-buttons .right-buttons[data-v-5bc188a2]{justify-content:flex-end}.album-form .form-buttons button[data-v-5bc188a2]{margin-right:16px}.left-buttons[data-v-5bc188a2]{flex-grow:1}","",{version:3,sources:["webpack://./src/components/Albums/AlbumForm.vue"],names:[],mappings:"AAoPA,6BACC,YAAA,CACA,qBAAA,CACA,YAAA,CACA,YAAA,CAEA,yCACC,gBAAA,CAGD,4CACC,+BAAA,CAGD,0CACC,WAAA,CACA,sBAAA,CAEA,gDACC,UAAA,CAGD,gDACC,YAAA,CACA,eAAA,CAEA,qDACC,iBAAA,CAKH,2CACC,YAAA,CACA,6BAAA,CAEA,mHACC,YAAA,CAGD,0DACC,wBAAA,CAGD,kDACC,iBAAA,CAKH,+BACC,WAAA",sourcesContent:['$sizes: ("400": ("count": 3, "marginTop": 66, "marginW": 8), "700": ("count": 4, "marginTop": 66, "marginW": 8), "1024": ("count": 5, "marginTop": 66, "marginW": 44), "1280": ("count": 4, "marginTop": 66, "marginW": 44), "1440": ("count": 5, "marginTop": 88, "marginW": 66), "1600": ("count": 6, "marginTop": 88, "marginW": 66), "2048": ("count": 7, "marginTop": 88, "marginW": 66), "2560": ("count": 8, "marginTop": 88, "marginW": 88), "3440": ("count": 9, "marginTop": 88, "marginW": 88), "max": ("count": 10, "marginTop": 88, "marginW": 88));\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\r\n.album-form {\r\n\tdisplay: flex;\r\n\tflex-direction: column;\r\n\theight: 350px;\r\n\tpadding: 16px;\r\n\r\n\t.form-title {\r\n\t\tfont-weight: bold;\r\n\t}\r\n\r\n\t.form-subtitle {\r\n\t\tcolor: var(--color-text-lighter);\r\n\t}\r\n\r\n\t.form-inputs {\r\n\t\tflex-grow: 1;\r\n\t\tjustify-items: flex-end;\r\n\r\n\t\tinput {\r\n\t\t\twidth: 100%;\r\n\t\t}\r\n\r\n\t\tlabel {\r\n\t\t\tdisplay: flex;\r\n\t\t\tmargin-top: 16px;\r\n\r\n\t\t\t::v-deep svg {\r\n\t\t\t\tmargin-right: 12px;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t.form-buttons {\r\n\t\tdisplay: flex;\r\n\t\tjustify-content: space-between;\r\n\r\n\t\t.left-buttons, .right-buttons {\r\n\t\t\tdisplay: flex;\r\n\t\t}\r\n\r\n\t\t.right-buttons {\r\n\t\t\tjustify-content: flex-end;\r\n\t\t}\r\n\r\n\t\tbutton {\r\n\t\t\tmargin-right: 16px;\r\n\t\t}\r\n\t}\r\n}\r\n\r\n.left-buttons {\r\n\tflex-grow: 1;\r\n}\r\n'],sourceRoot:""}]);const i=l},23238:(n,t,r)=>{r.d(t,{Z:()=>i});var e=r(87537),o=r.n(e),a=r(23645),l=r.n(a)()(o());l.push([n.id,".manage-collaborators[data-v-5b016e4c]{display:flex;flex-direction:column;padding:20px;height:500px}.manage-collaborators__title[data-v-5b016e4c]{font-weight:bold}.manage-collaborators__subtitle[data-v-5b016e4c]{color:var(--color-text-lighter)}.manage-collaborators__public-link-button[data-v-5b016e4c]{margin:4px 0}.manage-collaborators__form[data-v-5b016e4c]{margin-top:4px 0;display:flex;flex-direction:column}.manage-collaborators__form__input[data-v-5b016e4c]{position:relative;display:block}.manage-collaborators__form__input input[data-v-5b016e4c]{width:100%;padding-left:34px}.manage-collaborators__form__input .loading-icon[data-v-5b016e4c]{position:absolute;top:8px;right:8px}.manage-collaborators__form__list[data-v-5b016e4c]{padding:8px;height:350px;overflow:scroll}.manage-collaborators__form__list__result[data-v-5b016e4c]{padding:8px;border-radius:100px;box-sizing:border-box}.manage-collaborators__form__list__result[data-v-5b016e4c],.manage-collaborators__form__list__result *[data-v-5b016e4c]{cursor:pointer !important}.manage-collaborators__form__list__result[data-v-5b016e4c]:hover{background:var(--color-background-dark)}.manage-collaborators__form__list--empty[data-v-5b016e4c]{margin:100px 0}.manage-collaborators__selection[data-v-5b016e4c]{display:flex;flex-direction:column;margin-top:8px;flex-grow:1}.manage-collaborators__selection__item[data-v-5b016e4c]{border-radius:var(--border-radius-pill);padding:0 8px}.manage-collaborators__selection__item[data-v-5b016e4c]:hover{background:var(--color-background-dark)}.manage-collaborators .actions[data-v-5b016e4c]{display:flex;margin-top:8px}.manage-collaborators .actions__public-link[data-v-5b016e4c]{display:flex;align-items:center}.manage-collaborators .actions__public-link button[data-v-5b016e4c]{margin-left:8px}.manage-collaborators .actions__slot[data-v-5b016e4c]{flex-grow:1;display:flex;justify-content:flex-end;align-items:center}","",{version:3,sources:["webpack://./src/components/Albums/CollaboratorsSelectionForm.vue"],names:[],mappings:"AAgbA,uCACC,YAAA,CACA,qBAAA,CACA,YAAA,CACA,YAAA,CAEA,8CACC,gBAAA,CAGD,iDACC,+BAAA,CAGD,2DACC,YAAA,CAGD,6CACC,gBAAA,CACA,YAAA,CACA,qBAAA,CAEA,oDACC,iBAAA,CACA,aAAA,CAEA,0DACC,UAAA,CACA,iBAAA,CAGD,kEACC,iBAAA,CACA,OAAA,CACA,SAAA,CAIF,mDACC,WAAA,CACA,YAAA,CACA,eAAA,CAEA,2DACC,WAAA,CACA,mBAAA,CACA,qBAAA,CAEA,wHACC,yBAAA,CAGD,iEACC,uCAAA,CAIF,0DACC,cAAA,CAKH,kDACC,YAAA,CACA,qBAAA,CACA,cAAA,CACA,WAAA,CAEA,wDACC,uCAAA,CACA,aAAA,CAEA,8DACC,uCAAA,CAKH,gDACC,YAAA,CACA,cAAA,CAEA,6DACC,YAAA,CACA,kBAAA,CAEA,oEACC,eAAA,CAIF,sDACC,WAAA,CACA,YAAA,CACA,wBAAA,CACA,kBAAA",sourcesContent:['$sizes: ("400": ("count": 3, "marginTop": 66, "marginW": 8), "700": ("count": 4, "marginTop": 66, "marginW": 8), "1024": ("count": 5, "marginTop": 66, "marginW": 44), "1280": ("count": 4, "marginTop": 66, "marginW": 44), "1440": ("count": 5, "marginTop": 88, "marginW": 66), "1600": ("count": 6, "marginTop": 88, "marginW": 66), "2048": ("count": 7, "marginTop": 88, "marginW": 66), "2560": ("count": 8, "marginTop": 88, "marginW": 88), "3440": ("count": 9, "marginTop": 88, "marginW": 88), "max": ("count": 10, "marginTop": 88, "marginW": 88));\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\r\n.manage-collaborators {\r\n\tdisplay: flex;\r\n\tflex-direction: column;\r\n\tpadding: 20px;\r\n\theight: 500px;\r\n\r\n\t&__title {\r\n\t\tfont-weight: bold;\r\n\t}\r\n\r\n\t&__subtitle {\r\n\t\tcolor: var(--color-text-lighter);\r\n\t}\r\n\r\n\t&__public-link-button {\r\n\t\tmargin: 4px 0;\r\n\t}\r\n\r\n\t&__form {\r\n\t\tmargin-top: 4px 0;\r\n\t\tdisplay: flex;\r\n\t\tflex-direction: column;\r\n\r\n\t\t&__input {\r\n\t\t\tposition: relative;\r\n\t\t\tdisplay: block;\r\n\r\n\t\t\tinput {\r\n\t\t\t\twidth: 100%;\r\n\t\t\t\tpadding-left: 34px;\r\n\t\t\t}\r\n\r\n\t\t\t.loading-icon {\r\n\t\t\t\tposition: absolute;\r\n\t\t\t\ttop: calc(36px / 2 - 20px / 2);\r\n\t\t\t\tright: 8px;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t&__list {\r\n\t\t\tpadding: 8px;\r\n\t\t\theight: 350px;\r\n\t\t\toverflow: scroll;\r\n\r\n\t\t\t&__result {\r\n\t\t\t\tpadding: 8px;\r\n\t\t\t\tborder-radius: 100px;\r\n\t\t\t\tbox-sizing: border-box;\r\n\r\n\t\t\t\t&, & * {\r\n\t\t\t\t\tcursor: pointer !important;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t&:hover {\r\n\t\t\t\t\tbackground: var(--color-background-dark);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t&--empty {\r\n\t\t\t\tmargin: 100px 0;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t&__selection {\r\n\t\tdisplay: flex;\r\n\t\tflex-direction: column;\r\n\t\tmargin-top: 8px;\r\n\t\tflex-grow: 1;\r\n\r\n\t\t&__item {\r\n\t\t\tborder-radius: var(--border-radius-pill);\r\n\t\t\tpadding:  0 8px;\r\n\r\n\t\t\t&:hover {\r\n\t\t\t\tbackground: var(--color-background-dark);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t.actions {\r\n\t\tdisplay: flex;\r\n\t\tmargin-top: 8px;\r\n\r\n\t\t&__public-link {\r\n\t\t\tdisplay: flex;\r\n\t\t\talign-items: center;\r\n\r\n\t\t\tbutton {\r\n\t\t\t\tmargin-left: 8px;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t&__slot {\r\n\t\t\tflex-grow: 1;\r\n\t\t\tdisplay: flex;\r\n\t\t\tjustify-content: flex-end;\r\n\t\t\talign-items: center;\r\n\t\t}\r\n\t}\r\n}\r\n'],sourceRoot:""}]);const i=l},59008:(n,t,r)=>{r.d(t,{Z:()=>D});var e=r(20629),o=r(93050),a=r(94878),l=r(75400),i=r(45994),s=r(15961),c=r(80351),u=r.n(c),b=r(44714);function p(n,t,r,e,o,a,l){try{var i=n[a](l),s=i.value}catch(n){return void r(n)}i.done?t(s):Promise.resolve(s).then(e,o)}function m(n){return function(){var t=this,r=arguments;return new Promise((function(e,o){var a=n.apply(t,r);function l(n){p(a,e,o,l,i,"next",n)}function i(n){p(a,e,o,l,i,"throw",n)}l(void 0)}))}}function d(n,t){var r=Object.keys(n);if(Object.getOwnPropertySymbols){var e=Object.getOwnPropertySymbols(n);t&&(e=e.filter((function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),r.push.apply(r,e)}return r}function A(n){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?d(Object(r),!0).forEach((function(t){f(n,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(r)):d(Object(r)).forEach((function(t){Object.defineProperty(n,t,Object.getOwnPropertyDescriptor(r,t))}))}return n}function f(n,t,r){return t in n?Object.defineProperty(n,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):n[t]=r,n}const g={name:"AlbumForm",components:{MapMarker:o.Z,AccountMultiplePlus:a.Z,Send:l.Z,NcButton:s.P2,NcLoadingIcon:s.lb,NcTextField:s.h3,CollaboratorsSelectionForm:b.Z},props:{album:{type:Object,default:null},displayBackButton:{type:Boolean,default:!1}},data:function(){return{showCollaboratorView:!1,albumName:"",albumLocation:"",loading:!1}},computed:{editMode:function(){return null!==this.album},sharingEnabled:function(){return void 0!==OC.Share}},mounted:function(){var n=this;this.editMode&&(this.albumName=this.album.basename,this.albumLocation=this.album.location),this.$nextTick((function(){n.$refs.nameInput.$el.getElementsByTagName("input")[0].focus()}))},methods:A(A({},(0,e.nv)(["createAlbum","renameAlbum","updateAlbum"])),{},{submit:function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];""===this.albumName||this.loading||(this.editMode?this.handleUpdateAlbum():this.handleCreateAlbum(n))},handleCreateAlbum:function(){var n=arguments,t=this;return m(regeneratorRuntime.mark((function r(){var e,o;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return e=n.length>0&&void 0!==n[0]?n[0]:[],r.prev=1,t.loading=!0,r.next=5,t.createAlbum({album:{basename:t.albumName,filename:"/photos/".concat((0,i.ts)().uid,"/albums/").concat(t.albumName),nbItems:0,location:t.albumLocation,lastPhoto:-1,date:u()().format("MMMM YYYY"),collaborators:e}});case 5:if(o=r.sent,""===t.albumLocation&&0===e.length){r.next=10;break}return r.next=9,t.updateAlbum({albumName:t.albumName,properties:{location:t.albumLocation,collaborators:e}});case 9:o=r.sent;case 10:t.$emit("done",{album:o});case 11:return r.prev=11,t.loading=!1,r.finish(11);case 14:case"end":return r.stop()}}),r,null,[[1,,11,14]])})))()},handleUpdateAlbum:function(){var n=this;return m(regeneratorRuntime.mark((function t(){var r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,n.loading=!0,r=A({},n.album),n.album.basename===n.albumName){t.next=7;break}return t.next=6,n.renameAlbum({currentAlbumName:n.album.basename,newAlbumName:n.albumName});case 6:r=t.sent;case 7:if(n.album.location===n.albumLocation){t.next=11;break}return t.next=10,n.updateAlbum({albumName:n.albumName,properties:{location:n.albumLocation}});case 10:r.location=t.sent;case 11:n.$emit("done",{album:r});case 12:return t.prev=12,n.loading=!1,t.finish(12);case 15:case"end":return t.stop()}}),t,null,[[0,,12,15]])})))()},back:function(){this.$emit("back")}})};var h=r(93379),C=r.n(h),v=r(7795),_=r.n(v),y=r(90569),x=r.n(y),k=r(3565),w=r.n(k),E=r(19216),P=r.n(E),N=r(44589),O=r.n(N),S=r(62116),L={};L.styleTagTransform=O(),L.setAttributes=w(),L.insert=x().bind(null,"head"),L.domAPI=_(),L.insertStyleElement=P();C()(S.Z,L);S.Z&&S.Z.locals&&S.Z.locals;const D=(0,r(51900).Z)(g,(function(){var n=this,t=n.$createElement,r=n._self._c||t;return n.showCollaboratorView?r("CollaboratorsSelectionForm",{attrs:{"album-name":n.albumName,"allow-public-link":!1},scopedSlots:n._u([{key:"default",fn:function(t){var e=t.collaborators;return[r("span",{staticClass:"left-buttons"},[r("NcButton",{attrs:{"aria-label":n.t("photos","Back to the new album form."),type:"tertiary"},on:{click:function(t){n.showCollaboratorView=!1}}},[n._v("\n\t\t\t\t"+n._s(n.t("photos","Back"))+"\n\t\t\t")])],1),n._v(" "),r("span",{staticClass:"right-buttons"},[r("NcButton",{attrs:{"aria-label":n.editMode?n.t("photos","Save."):n.t("photos","Create the album."),type:"primary",disabled:""===n.albumName.trim()||n.loading},on:{click:function(t){return n.submit(e)}},scopedSlots:n._u([{key:"icon",fn:function(){return[n.loading?r("NcLoadingIcon"):r("Send")]},proxy:!0}],null,!0)},[n._v("\n\t\t\t\t"+n._s(n.editMode?n.t("photos","Save"):n.t("photos","Create album"))+"\n\t\t\t")])],1)]}}])}):r("form",{staticClass:"album-form",on:{submit:function(t){return t.preventDefault(),n.submit.apply(null,arguments)}}},[r("div",{staticClass:"form-inputs"},[r("NcTextField",{ref:"nameInput",attrs:{value:n.albumName,type:"text",name:"name",required:!0,autofocus:"true",placeholder:n.t("photos","Name of the album")},on:{"update:value":function(t){n.albumName=t}}}),n._v(" "),r("label",[r("MapMarker"),r("NcTextField",{attrs:{value:n.albumLocation,name:"location",type:"text",placeholder:n.t("photos","Location of the album")},on:{"update:value":function(t){n.albumLocation=t}}})],1)],1),n._v(" "),r("div",{staticClass:"form-buttons"},[r("span",{staticClass:"left-buttons"},[n.displayBackButton?r("NcButton",{attrs:{"aria-label":n.t("photos","Go back to the previous view."),type:"tertiary"},on:{click:n.back}},[n._v("\n\t\t\t\t"+n._s(n.t("photos","Back"))+"\n\t\t\t")]):n._e()],1),n._v(" "),r("span",{staticClass:"right-buttons"},[n.sharingEnabled&&!n.editMode?r("NcButton",{attrs:{"aria-label":n.t("photos","Go to the add collaborators view."),type:"secondary",disabled:""===n.albumName.trim()||n.loading},on:{click:function(t){n.showCollaboratorView=!0}},scopedSlots:n._u([{key:"icon",fn:function(){return[r("AccountMultiplePlus")]},proxy:!0}],null,!1,1531126728)},[n._v("\n\t\t\t\t"+n._s(n.t("photos","Add collaborators"))+"\n\t\t\t")]):n._e(),n._v(" "),r("NcButton",{attrs:{"aria-label":n.editMode?n.t("photos","Save."):n.t("photos","Create the album."),type:"primary",disabled:""===n.albumName||n.loading},on:{click:function(t){return n.submit()}},scopedSlots:n._u([{key:"icon",fn:function(){return[n.loading?r("NcLoadingIcon"):r("Send")]},proxy:!0}],null,!1,3914512768)},[n._v("\n\t\t\t\t"+n._s(n.editMode?n.t("photos","Save"):n.t("photos","Create album"))+"\n\t\t\t")])],1)])])}),[],!1,null,"5bc188a2",null).exports},44714:(n,r,e)=>{e.d(r,{Z:()=>Z});var o=e(20629),a=e(38530),l=e(31894),i=e(14625),s=e(47987),c=e(86472),u=e(55683),b=e(26937),p=e(82880),m=e(45994),d=e(79753),A=e(15961),f=e(41922),g=e(59537),h=e(69363),C=e(99622);function v(n,t,r,e,o,a,l){try{var i=n[a](l),s=i.value}catch(n){return void r(n)}i.done?t(s):Promise.resolve(s).then(e,o)}function _(n){return function(){var t=this,r=arguments;return new Promise((function(e,o){var a=n.apply(t,r);function l(n){v(a,e,o,l,i,"next",n)}function i(n){v(a,e,o,l,i,"throw",n)}l(void 0)}))}}function y(n,t){var r=Object.keys(n);if(Object.getOwnPropertySymbols){var e=Object.getOwnPropertySymbols(n);t&&(e=e.filter((function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),r.push.apply(r,e)}return r}function x(n){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?y(Object(r),!0).forEach((function(t){k(n,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(r)):y(Object(r)).forEach((function(t){Object.defineProperty(n,t,Object.getOwnPropertyDescriptor(r,t))}))}return n}function k(n,t,r){return t in n?Object.defineProperty(n,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):n[t]=r,n}const w={name:"CollaboratorsSelectionForm",components:{Magnify:a.Z,Close:l.default,AccountGroup:c.Z,ContentCopy:s.Z,Check:i.default,Earth:u.Z,NcLoadingIcon:A.lb,NcButton:A.P2,NcListItemIcon:A.Ic,NcTextField:A.h3,NcPopover:A.Fh,NcEmptyContent:A.SL},mixins:[h.Z],props:{albumName:{type:String,required:!0},collaborators:{type:Array,default:function(){return[]}},allowPublicLink:{type:Boolean,default:!0}},data:function(){return{searchText:"",availableCollaborators:{},selectedCollaboratorsKeys:[],currentSearchResults:[],loadingAlbum:!1,errorFetchingAlbum:null,loadingCollaborators:!1,randomId:Math.random().toString().substring(2,10),publicLinkCopied:!1,config:{minSearchStringLength:parseInt(OC.config["sharing.minSearchStringLength"],10)||0}}},computed:{searchResults:function(){var n=this;return this.currentSearchResults.filter((function(n){return n.id!==(0,m.ts)().uid})).map((function(n){var t=n.type,r=n.id;return"".concat(t,":").concat(r)})).filter((function(t){return!n.selectedCollaboratorsKeys.includes(t)}))},listableSelectedCollaboratorsKeys:function(){var n=this;return this.selectedCollaboratorsKeys.filter((function(t){return n.availableCollaborators[t].type!==f.D.SHARE_TYPE_LINK}))},selectedCollaborators:function(){var n=this;return this.selectedCollaboratorsKeys.map((function(t){return n.availableCollaborators[t]}))},isPublicLinkSelected:function(){return this.selectedCollaboratorsKeys.includes("".concat(f.D.SHARE_TYPE_LINK))},publicLink:function(){return this.availableCollaborators[f.D.SHARE_TYPE_LINK]}},watch:{collaborators:function(n){this.populateCollaborators(n)}},mounted:function(){this.searchCollaborators(),this.populateCollaborators(this.collaborators)},methods:x(x({},(0,o.nv)(["updateAlbum","addAlbums"])),{},{searchCollaborators:function(){var n=this;return _(regeneratorRuntime.mark((function r(){var e;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(n.searchText.length>=1&&n.$refs.popover.$refs.popover.show(),r.prev=1,!(n.searchText.length<n.config.minSearchStringLength)){r.next=4;break}return r.abrupt("return");case 4:return n.loadingCollaborators=!0,r.next=7,b.Z.get((0,d.generateOcsUrl)("core/autocomplete/get"),{params:{search:n.searchText,itemType:"share-recipients",shareTypes:[f.D.SHARE_TYPE_USER,f.D.SHARE_TYPE_GROUP]}});case 7:e=r.sent,n.currentSearchResults=e.data.ocs.data.map((function(n){switch(n.source){case"users":return{id:n.id,label:n.label,type:f.D.SHARE_TYPE_USER};case"groups":return{id:n.id,label:n.label,type:f.D.SHARE_TYPE_GROUP};default:throw new Error("Invalid collaborator source ".concat(n.source))}})),n.availableCollaborators=x(x({},n.availableCollaborators),n.currentSearchResults.reduce(n.indexCollaborators,{})),r.next=17;break;case 12:r.prev=12,r.t0=r.catch(1),n.errorFetchingCollaborators=r.t0,g.Z.error(t("photos","Failed to fetch collaborators list."),r.t0),(0,p.showError)(t("photos","Failed to fetch collaborators list."));case 17:return r.prev=17,n.loadingCollaborators=!1,r.finish(17);case 20:case"end":return r.stop()}}),r,null,[[1,12,17,20]])})))()},populateCollaborators:function(n){var r=n.reduce(this.indexCollaborators,{});this.selectedCollaboratorsKeys=Object.keys(r),this.availableCollaborators=x(x({3:{id:"",label:t("photos","Public link"),type:f.D.SHARE_TYPE_LINK}},this.availableCollaborators),r)},indexCollaborators:function(n,t){return x(x({},n),{},k({},"".concat(t.type).concat(t.type===f.D.SHARE_TYPE_LINK?"":":").concat(t.type===f.D.SHARE_TYPE_LINK?"":t.id),t))},createPublicLinkForAlbum:function(){var n=this;return _(regeneratorRuntime.mark((function t(){var r,e;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n.selectEntity("".concat(f.D.SHARE_TYPE_LINK)),t.next=3,n.updateAlbumCollaborators();case 3:return t.prev=3,n.loadingAlbum=!0,n.errorFetchingAlbum=null,t.next=8,(0,C.Lz)("/photos/".concat((0,m.ts)().uid,"/albums/").concat(n.albumName),{signal:n.abortController.signal});case 8:r=t.sent,n.addAlbums({albums:[r]}),t.next=17;break;case 12:t.prev=12,t.t0=t.catch(3),404===(null===(e=t.t0.response)||void 0===e?void 0:e.status)?n.errorFetchingAlbum=404:n.errorFetchingAlbum=t.t0,g.Z.error("[PublicAlbumContent] Error fetching album",{error:t.t0}),(0,p.showError)(n.t("photos","Failed to fetch album."));case 17:return t.prev=17,n.loadingAlbum=!1,t.finish(17);case 20:case"end":return t.stop()}}),t,null,[[3,12,17,20]])})))()},deletePublicLink:function(){var n=this;return _(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return n.unselectEntity("".concat(f.D.SHARE_TYPE_LINK)),n.availableCollaborators[3]={id:"",label:t("photos","Public link"),type:f.D.SHARE_TYPE_LINK},n.publicLinkCopied=!1,r.next=5,n.updateAlbumCollaborators();case 5:case"end":return r.stop()}}),r)})))()},updateAlbumCollaborators:function(){var n=this;return _(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,n.updateAlbum({albumName:n.albumName,properties:{collaborators:n.selectedCollaborators}});case 3:t.next=9;break;case 5:t.prev=5,t.t0=t.catch(0),g.Z.error("[PublicAlbumContent] Error updating album",{error:t.t0}),(0,p.showError)(n.t("photos","Failed to update album."));case 9:return t.prev=9,n.loadingAlbum=!1,t.finish(9);case 12:case"end":return t.stop()}}),t,null,[[0,5,9,12]])})))()},copyPublicLink:function(){var n=this;return _(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,navigator.clipboard.writeText("".concat(window.location.protocol,"//").concat(window.location.host).concat((0,d.generateUrl)("apps/photos/public/".concat(n.publicLink.id))));case 2:n.publicLinkCopied=!0,setTimeout((function(){n.publicLinkCopied=!1}),1e4);case 4:case"end":return t.stop()}}),t)})))()},selectEntity:function(n){this.selectedCollaboratorsKeys.includes(n)||(this.$refs.popover.$refs.popover.hide(),this.selectedCollaboratorsKeys.push(n))},unselectEntity:function(n){var t=this.selectedCollaboratorsKeys.indexOf(n);-1!==t&&this.selectedCollaboratorsKeys.splice(t,1)}})};var E=e(93379),P=e.n(E),N=e(7795),O=e.n(N),S=e(90569),L=e.n(S),D=e(3565),T=e.n(D),j=e(19216),B=e.n(j),R=e(44589),I=e.n(R),F=e(23238),Y={};Y.styleTagTransform=I(),Y.setAttributes=T(),Y.insert=L().bind(null,"head"),Y.domAPI=O(),Y.insertStyleElement=B();P()(F.Z,Y);F.Z&&F.Z.locals&&F.Z.locals;const Z=(0,e(51900).Z)(w,(function(){var n=this,t=n.$createElement,r=n._self._c||t;return r("div",{staticClass:"manage-collaborators"},[r("h2",{staticClass:"manage-collaborators__title"},[n._v("\n\t\t"+n._s(n.t("photos","Add collaborators"))+"\n\t")]),n._v(" "),r("div",{staticClass:"manage-collaborators__subtitle"},[n._v("\n\t\t"+n._s(n.t("photos","Add people or groups who can edit your album"))+"\n\t")]),n._v(" "),r("form",{staticClass:"manage-collaborators__form",on:{submit:function(n){n.preventDefault()}}},[r("NcPopover",{ref:"popover",attrs:{"auto-size":!0,distance:0}},[r("label",{staticClass:"manage-collaborators__form__input",attrs:{slot:"trigger"},slot:"trigger"},[r("NcTextField",{attrs:{value:n.searchText,autocomplete:"off",type:"search",name:"search","aria-label":n.t("photos","Search for collaborators"),"aria-autocomplete":"list","aria-controls":"manage-collaborators__form__selection-"+n.randomId+" manage-collaborators__form__list-"+n.randomId,placeholder:n.t("photos","Search people or groups")},on:{"update:value":function(t){n.searchText=t},input:n.searchCollaborators}},[r("Magnify",{attrs:{size:16}})],1),n._v(" "),n.loadingCollaborators?r("NcLoadingIcon"):n._e()],1),n._v(" "),0!==n.searchResults.length?r("ul",{staticClass:"manage-collaborators__form__list",attrs:{id:"manage-collaborators__form__list-"+n.randomId}},n._l(n.searchResults,(function(t){return r("li",{key:t},[r("NcListItemIcon",{staticClass:"manage-collaborators__form__list__result",attrs:{id:n.availableCollaborators[t].id,title:n.availableCollaborators[t].id,search:n.searchText,user:n.availableCollaborators[t].id,"display-name":n.availableCollaborators[t].label,"aria-label":n.t("photos","Add {collaboratorLabel} to the collaborators list",{collaboratorLabel:n.availableCollaborators[t].label}),tabindex:"0"},on:{click:function(r){return n.selectEntity(t)}}})],1)})),0):r("NcEmptyContent",{key:"emptycontent",staticClass:"manage-collaborators__form__list--empty",attrs:{title:n.t("photos","No collaborators available")}},[r("AccountGroup",{attrs:{slot:"icon"},slot:"icon"})],1)],1)],1),n._v(" "),r("ul",{staticClass:"manage-collaborators__selection"},n._l(n.listableSelectedCollaboratorsKeys,(function(t){return r("li",{key:t,staticClass:"manage-collaborators__selection__item"},[r("NcListItemIcon",{attrs:{id:n.availableCollaborators[t].id,"display-name":n.availableCollaborators[t].label,title:n.availableCollaborators[t].id,user:n.availableCollaborators[t].id}},[r("NcButton",{attrs:{type:"tertiary","aria-label":n.t("photos","Remove {collaboratorLabel} from the collaborators list",{collaboratorLabel:n.availableCollaborators[t].label})},on:{click:function(r){return n.unselectEntity(t)}}},[r("Close",{attrs:{slot:"icon",size:20},slot:"icon"})],1)],1)],1)})),0),n._v(" "),r("div",{staticClass:"actions"},[n.allowPublicLink?r("div",{staticClass:"actions__public-link"},[n.isPublicLinkSelected?[r("NcButton",{staticClass:"manage-collaborators__public-link-button",attrs:{"aria-label":n.t("photos","Copy the public link"),disabled:""===n.publicLink.id},on:{click:n.copyPublicLink},scopedSlots:n._u([{key:"icon",fn:function(){return[n.publicLinkCopied?r("Check"):r("ContentCopy")]},proxy:!0}],null,!1,845538853)},[n.publicLinkCopied?[n._v("\n\t\t\t\t\t\t"+n._s(n.t("photos","Public link copied!"))+"\n\t\t\t\t\t")]:[n._v("\n\t\t\t\t\t\t"+n._s(n.t("photos","Copy public link"))+"\n\t\t\t\t\t")]],2),n._v(" "),r("NcButton",{attrs:{type:"tertiary","aria-label":n.t("photos","Delete the public link"),disabled:""===n.publicLink.id},on:{click:n.deletePublicLink}},[""===n.publicLink.id?r("NcLoadingIcon",{attrs:{slot:"icon"},slot:"icon"}):r("Close",{attrs:{slot:"icon"},slot:"icon"})],1)]:r("NcButton",{staticClass:"manage-collaborators__public-link-button",on:{click:n.createPublicLinkForAlbum}},[r("Earth",{attrs:{slot:"icon"},slot:"icon"}),n._v("\n\t\t\t\t"+n._s(n.t("photos","Share via public link"))+"\n\t\t\t")],1)],2):n._e(),n._v(" "),r("div",{staticClass:"actions__slot"},[n._t("default",null,{collaborators:n.selectedCollaborators})],2)])])}),[],!1,null,"5b016e4c",null).exports}}]);
//# sourceMappingURL=photos-src_mixins_FetchAlbumsMixin_js-src_components_Albums_AlbumForm_vue.js.map?v=4720e2e394337403751f